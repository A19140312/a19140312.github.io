<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4"><link rel="mask-icon" href="/images/favicon.ico?v=5.1.4" color="#222"><meta name="keywords" content="Go,面试,"><meta name="description" content="Go 面试基础使用值为 nil 的 slice、map会发生啥允许对值为 nil 的 slice 添加元素，但对值为 nil 的 map 添加元素，则会造成运行时 panic。 解析 JSON 数据时，默认将数值当做哪种类型在 encode&#x2F;decode JSON 数据时，Go 默认会将数值当做 float64 处理。 recover的执行时机recover 必须在 defer 的func中运行。"><meta property="og:type" content="article"><meta property="og:title" content="Go面试必备"><meta property="og:url" content="https://a19140312.github.io/%E9%9D%A2%E8%AF%95/Go-Interview/index.html"><meta property="og:site_name" content="qing&#39;s 随笔"><meta property="og:description" content="Go 面试基础使用值为 nil 的 slice、map会发生啥允许对值为 nil 的 slice 添加元素，但对值为 nil 的 map 添加元素，则会造成运行时 panic。 解析 JSON 数据时，默认将数值当做哪种类型在 encode&#x2F;decode JSON 数据时，Go 默认会将数值当做 float64 处理。 recover的执行时机recover 必须在 defer 的func中运行。"><meta property="og:locale"><meta property="og:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg=="><meta property="article:published_time" content="2021-10-06T03:50:00.000Z"><meta property="article:modified_time" content="2021-10-12T12:43:38.109Z"><meta property="article:author" content="guyuqing"><meta property="article:tag" content="Go"><meta property="article:tag" content="面试"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg=="><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"",scheme:"Mist",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><script></script><link rel="canonical" href="https://a19140312.github.io/面试/Go-Interview/"><script src="https://neveryu.github.io/js/src/pace.min.js"></script><script data-ad-client="ca-pub-3961457011147580" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><title>Go面试必备 | qing's 随笔</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">qing's 随笔</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://a19140312.github.io/%E9%9D%A2%E8%AF%95/Go-Interview/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content=""><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="qing's 随笔"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Go面试必备</h1><div class="post-meta"><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/authors/Guyuqing" itemprop="url" rel="index"><span itemprop="name">Guyuqing</span> </a></span><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-10-06T11:50:00+08:00">2021-10-06 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">面试</span> </a></span></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i> 阅读数 <span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Go-面试"><a href="#Go-面试" class="headerlink" title="Go 面试"></a>Go 面试</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="使用值为-nil-的-slice、map会发生啥"><a href="#使用值为-nil-的-slice、map会发生啥" class="headerlink" title="使用值为 nil 的 slice、map会发生啥"></a>使用值为 nil 的 slice、map会发生啥</h3><p>允许对值为 nil 的 slice 添加元素，但对值为 nil 的 map 添加元素，则会造成运行时 panic。</p><h3 id="解析-JSON-数据时，默认将数值当做哪种类型"><a href="#解析-JSON-数据时，默认将数值当做哪种类型" class="headerlink" title="解析 JSON 数据时，默认将数值当做哪种类型"></a>解析 JSON 数据时，默认将数值当做哪种类型</h3><p>在 encode/decode JSON 数据时，Go 默认会将数值当做 float64 处理。</p><h3 id="recover的执行时机"><a href="#recover的执行时机" class="headerlink" title="recover的执行时机"></a>recover的执行时机</h3><p>recover 必须在 defer 的func中运行。recover 捕获的是祖父级调用时的异常，直接调用时无效。</p><h3 id="new和make的区别"><a href="#new和make的区别" class="headerlink" title="new和make的区别"></a>new和make的区别</h3><p>new ：是初始化一个指向类型的指针 (*T) 。new 函数是内建函数，函数定义：func new(Type) *Type。使用 new 函数来分配空间。传递给 new 函数的是一个类型，不是一个值。返回值是指向这个新分配的零值的指针。</p><p>make ：是为 slice，map 或 chan 初始化并返回引用 (T)。make 函数是内建函数，函数定义：func make(Type, size IntegerType) Type；第一个参数是一个类型，第二个参数是长度；返回值是一个类型。</p><p>make(T, args) 函数的目的与 new(T) 不同。它仅仅用于创建 Slice, Map 和 Channel，并且返回类型是 T（不是T*）的一个初始化的（不是零值）的实例。</p><h3 id="go语言中的引用类型包含哪些"><a href="#go语言中的引用类型包含哪些" class="headerlink" title="go语言中的引用类型包含哪些"></a>go语言中的引用类型包含哪些</h3><p>数组切片、字典(map)、通道（channel）、接口（interface）。</p><h3 id="go-struct能不能比较"><a href="#go-struct能不能比较" class="headerlink" title="go struct能不能比较"></a>go struct能不能比较</h3><p>因为是强类型语言，所以不同类型的结构不能作比较，但是同一类型的实例值是可以比较的，实例不可以比较，因为是指针类型</p><h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://pic.comeouton.top/context.jpeg"></p><h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><h3 id="Map-结构"><a href="#Map-结构" class="headerlink" title="Map 结构"></a>Map 结构</h3><p>map类型的变量本质上是一个hmap类型的指针，这些键值对实际上是通过哈希表来存储的。<br>哈希表首先要有一段内存用作存储键值对的桶(bucket)，map的桶，每个桶里可以存储8个键值对，并且为了内存使用更加紧凑，8个键放一起，8个值放一起。<br>对应每个key只保存其哈希值的高8位（tophash）。而每个键值对的tophash、key和value的索引顺序一一对应。当桶存满了，扩容的代价还是比较高的，所以为了减少扩容次数，这里引入了溢出桶(overflow)指针。</p><h3 id="Map-扩容"><a href="#Map-扩容" class="headerlink" title="Map 扩容"></a>Map 扩容</h3><p>map的扩容有两种情况，如果超过负载因子(默认6.5)就触发翻倍扩容，然后采用渐进式扩容方法，每次读写map时检测到当前map处在扩容阶段（hmap.oldbuckets != nil），就执行一次迁移工作，把编号为hmap.nevacuate的旧桶迁移到新桶，每个旧桶的键值对都会分流到两个新桶中。</p><p>如果没有超过设置的负载因子上限，但是使用的溢出桶较多，也会触发扩容，不过这一次是等量扩容。</p><p>（1）如果常规桶数目不大于2^15，那么使用的溢出桶数目超过常规桶就算是多了；<br>（2）如果常规桶数目大于2^15，那么使用溢出桶数目一旦超过2^15就算多了。</p><p>为什么桶的负载因子没有超过上限值，却偏偏使用了很多溢出桶呢？自然是有很多键值对被删除的情况。</p><p>正是因为扩容过程中会发生键值对迁移，键值对的地址也会发生改变，所以才说map的元素是不可寻址的，如果要取一个value的地址则不能通过编译。</p><h2 id="Slice"><a href="#Slice" class="headerlink" title="Slice"></a>Slice</h2><h3 id="切片和数组的区别"><a href="#切片和数组的区别" class="headerlink" title="切片和数组的区别"></a>切片和数组的区别</h3><p>数组是具有固定长度，且拥有零个或者多个，相同数据类型元素的序列。数组的长度是数组类型的一部分，所以[3]int 和 [4]int 是两种不同的数组类型。数组需要指定大小，不指定也会根据初始化的自动推算出大小，不可改变；数组是值传递。数组是内置类型，是一组同类型数据的集合，它是值类型，通过从0开始的下标索引访问元素值。在初始化后长度是固定的，无法修改其长度。当作为方法的参数传入时将复制一份数组而不是引用同一指针。</p><p>切片表示一个拥有相同类型元素的可变长度的序列。切片是一种轻量级的数据结构，它有三个属性：指针、长度和容量。切片不需要指定大小；切片是地址传递；切片可以通过数组来初始化，也可以通过内置函数make()初始化 。初始化时len=cap,在追加元素时如果容量cap不足时将按len的2倍扩容。</p><h3 id="Slice的底层实现"><a href="#Slice的底层实现" class="headerlink" title="Slice的底层实现"></a>Slice的底层实现</h3><p>切片对象非常小，是因为它是只有3个字段的数据结构：</p><ul><li>指向底层数组的指针</li><li>切片的长度</li><li>切片的容量</li></ul><h3 id="Slice的扩容机制，有什么注意点"><a href="#Slice的扩容机制，有什么注意点" class="headerlink" title="Slice的扩容机制，有什么注意点"></a>Slice的扩容机制，有什么注意点</h3><p>Go 中切片扩容的策略是这样的：</p><p>首先判断，如果新申请容量大于 2 倍的旧容量，最终容量就是新申请的容量。否则判断，如果旧切片的长度小于 1024，则最终容量就是旧容量的两倍。</p><p>否则判断，如果旧切片长度大于等于 1024，则最终容量从旧容量开始循环增加原来的 1/4 , 直到最终容量大于等于新申请的容量。如果最终容量计算值溢出，则最终容量就是新申请容量。</p><p>情况一：原数组还有容量可以扩容（实际容量没有填充完），这种情况下，扩容以后的数组还是指向原来的数组，对一个切片的操作可能影响多个指针指向相同地址的Slice。</p><p>情况二：原来数组的容量已经达到了最大值，再想扩容， Go 默认会先开一片内存区域，把原来的值拷贝过来，然后再执行 append() 操作。这种情况丝毫不影响原数组。</p><p>要复制一个Slice，最好使用Copy函数。</p><h2 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h2><h3 id="Channel-的底层实现"><a href="#Channel-的底层实现" class="headerlink" title="Channel 的底层实现"></a>Channel 的底层实现</h3><p>channel分为“无缓冲”和“有缓冲”两种，对于有缓冲channel来讲，需要有相应的内存来存储数据，实际上就是一个数组。</p><p>hchan 需要记录数组的地址buf、容量datasiz、元素类型elemtype、元素的大小elemsize，以及已有元素个数qcount。</p><p>channel支持交替的读写（称send为写，recv为读）有缓冲channel内的缓冲数组会被作为一个“环型”来使用，当下标超过数组容量后会回到第一个位置，所以要分别记录读写下标的位置。</p><p>当读和写操作不能立即完成时，需要能够让当前协程在channel上等待，当条件满足时，要能够立即唤醒等待的协程，所以要有两个等待队列，分别针对读和写。</p><p>等待队列是runtime.sudog类型的双向链表，sudog中会记录是哪个协程在等待，等待哪一个channel等等。特别是sudog.elem这个成员，对于recvq中的sudog而言，它代表recv到数据以后要存储到哪里；对于sendq中的sudog而言，它代表要send的数据在哪里。</p><p>channel还可以关闭，因此还需要一个close字段。而且为了应对并发操作，channel还需要有一把锁lock。</p><h3 id="channel-关闭后会怎样？"><a href="#channel-关闭后会怎样？" class="headerlink" title="channel 关闭后会怎样？"></a>channel 关闭后会怎样？</h3><h4 id="recvq里有协程等待"><a href="#recvq里有协程等待" class="headerlink" title="recvq里有协程等待"></a>recvq里有协程等待</h4><p>若channel关闭，hchan.closed=1；等待recv的协程接收到零值和false；协程离开channel的recvq回到run queue中。</p><h4 id="缓冲区还有数据，但sendq-为空"><a href="#缓冲区还有数据，但sendq-为空" class="headerlink" title="缓冲区还有数据，但sendq 为空"></a>缓冲区还有数据，但sendq 为空</h4><p>channel关闭后，缓冲区里的数据还可以读，直到读完。但是不能再写，否则会panic。</p><h4 id="sendq不为空"><a href="#sendq不为空" class="headerlink" title="sendq不为空"></a>sendq不为空</h4><p>这些等待send的G都会离开sendq，恢复到_Grunnable状态，回到协程run queue中，协程恢复执行时会发生panic。</p><h2 id="Goroutine"><a href="#Goroutine" class="headerlink" title="Goroutine"></a>Goroutine</h2><h3 id="进程、线程、协程"><a href="#进程、线程、协程" class="headerlink" title="进程、线程、协程"></a>进程、线程、协程</h3><p>进程：为了更合理的利用 CPU 资源，把内存划分为多块，不同程序使用各自的内存空间互不干扰，这里单独的程序就是一个进程，CPU 可以在多个进程之间切换执行，让 CPU 的利用率变高。为了实现 CPU 在多个进程之间切换，需要保存进程的上下文（如程序计数器、栈、内核数据结构等等），以便下次切换回来可以恢复执行</p><p>线程：线程是操作系统进行运算调度的最小单位。线程属于进程，一个进程中可以并发多个线程。进程有自己独立的内存空间，而线程（同进程中）是共享内存空间。</p><p>协程：用户态线程。其创建和切换都在用户代码中完成而无需进入操作系统内核，所以其开销要远远小于系统线程的创建和切换;</p><h3 id="GMP模型"><a href="#GMP模型" class="headerlink" title="GMP模型"></a>GMP模型</h3><p>G：Goroutine，实际上我们每次调用 go func 就是生成了一个 G。</p><p>P：Processor，处理器，一般 P 的数量就是处理器的核数，可以通过 GOMAXPROCS 进行修改。</p><p>M：Machine，系统线程。</p><p>执行流程：</p><ol><li>首先程序运行入口runtime.main会初始化M0和G0和P0。</li><li>然后执行main.main创建一个G，由M0运行。</li><li>当有其他G创建时，将G保存到当前P的本地队列，当本地队列元素放满时，放入全局队列。</li><li>当有其他空闲P时会唤醒M或者创建M。</li><li>然后M执行一个调度循环：调用G对象（当前P的本地队列 &gt; 全局队列 &gt; 其他P的队列）-&gt;执行-&gt;清理线程-&gt;继续寻找Goroutine。</li><li>当M阻塞时，会记录当前P，将M从P解除。把G运行在其他空闲的M或者创建新的M。</li><li>当M恢复时，会尝试获得上次的P，若没有空闲，尝试获取一个空闲的P。如果没有P空闲，M会休眠，G会放到全局队列。</li></ol><h3 id="GMP模型的限制"><a href="#GMP模型的限制" class="headerlink" title="GMP模型的限制"></a>GMP模型的限制</h3><ul><li>M 的限制：在 Go 语言中，M 的默认数量限制是 10000，如果超出则会报错</li><li>G 的限制：理论上会受内存的影响，假设一个 Goroutine 创建需要2～4k，4k * 1,000,000 = 4,000,000k ≈ 4G内存</li><li>P 的限制：P 的数量受环境变量 GOMAXPROCS 的直接影响。基本是受本机的核数影响</li></ul><h2 id="sync"><a href="#sync" class="headerlink" title="sync"></a>sync</h2><h3 id="sync-WaitGroup-的实现"><a href="#sync-WaitGroup-的实现" class="headerlink" title="sync.WaitGroup 的实现"></a>sync.WaitGroup 的实现</h3><p>waitGroup的数据结构主要包括一个有复合意义的state1</p><ul><li>在64位环境下：state1[0]是 waiter 数，state1[1]是 WaitGroup 的计数值，state1[2]是信号量。</li><li>在32位环境下： state1[0]是信号量，state1[1]是 waiter 数，state1[2]是计数值。</li></ul><p>当调用 Add 时，主要操作的state1字段中计数值部分+1<br>调用 Done 时，就是Add（-1）<br>wait 的实现思路：不断检查state值，如果其中的计数值为零，则说明所有的子goroutine已全部执行完毕，调用者不必等待，直接返回。如果计数值大于零，说明此时还有任务没有完成，那么调用者变成等待者，需要加入wait队列，并且阻塞自己。</p><h3 id="sync-Mutex-的实现"><a href="#sync-Mutex-的实现" class="headerlink" title="sync.Mutex 的实现"></a>sync.Mutex 的实现</h3><p>Mutex包括state状态0未加锁，大于0已加锁，和sema信号量。</p><ul><li>正常模式：一个待加锁的G会尝试自旋几次尝试获得锁，若仍然不能获得锁，则通过信号量排队等待，所有的等待者会按照先入先出的顺序排队，但是当锁被释放时，第一个等待着被唤醒后不会直接拥有锁，而是需要和后来者也就是正在自旋的锁竞争，这种情况下后来者更有优势，一方面他们正在cpu上运行（当前正在cpu上占用时间片的goroutine比唤醒的goroutine抢占锁的概率高，是因为不需要上下文切换，因而抢占机会大一点），另一方面处于运行中的G可以有很多，而被唤醒的只有一个，所以被唤醒的G有很大概率拿不到锁，这种情况下，被唤醒的G会被重新插入队列的头部。而当一个G当前等待的时间超过1ms后，会由正常模式变为饥饿模式。</li><li>饥饿模式：Mutex的所有权从执行unlock的G直接传递给等待队列头部的G，后来者不会自旋转，也不会尝试获得锁，直接进入队列尾部排队等待。当一个等待者获得锁时，当前等待者的等待时间小于1ms时或者它是最后一个等待者，会将饥饿模式变为正常模式</li></ul><h3 id="sync-Map-的实现"><a href="#sync-Map-的实现" class="headerlink" title="sync.Map 的实现"></a>sync.Map 的实现</h3><ul><li>空间换时间。通过冗余的两个数据结构(只读的 read 字段、可写的 dirty)，来减少加 锁对性能的影响。对只读字段(read)的操作不需要加锁。</li><li>优先从 read 字段读取、更新、删除，因为对 read 字段的读取不需要锁。</li><li>动态调整。miss 次数多了之后，将 dirty 数据提升为 read，避免总是从 dirty 中加锁读 取。</li><li>double-checking。加锁之后先还要再检查 read 字段，确定真的不存在才操作 dirty 字 段。</li><li>延迟删除。删除一个键值只是打标记，只有在提升 dirty 字段为 read 字段的时候才清理 删除的数据。</li></ul><p>store：它是用来设置一个键值对，或者更新一个键值对的。如果运气好的话，更新的是已存在的未被删除的元素，直接更新read即可，不会用到锁。如果运气不好，需要更新(重用) 删除的对象、更新还未提升的 dirty 中的对象，或者新增加元素的时候就会使用到了锁。新加的元素需要放入到 dirty 中，如果 dirty 为 nil，那么需要从 read 字段中复制出来一个 dirty 对象。</p><p>Load：用来读取一个 key 对应的值。我们从 read 中读取到了这个 key 对应的值，那么就不需要加锁了。但是，如果请求的 key 不存在或者是新加的，就需要加锁从 dirty 中读取。其中，missLocked 增加 miss 的时候，如果 miss 数等于 dirty 长度，会将 dirty 提升为 read，并将 dirty 置空。</p><p>Delete：如果 read 中不存在，那么就需要从 dirty 中寻找这个项目。最终，如果项目存在就删除 (将它的值标记为 nil)。如果项目不为 nil 或者没有被标记为 expunged，那么还可以把 它的值返回。</p><h4 id="为什么要double-check？"><a href="#为什么要double-check？" class="headerlink" title="为什么要double check？"></a>为什么要double check？</h4><p>先检查一遍，然后加锁再检查一遍，避免第一次检查后、加锁前，内容被修改。</p><h2 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h2><h3 id="go-gc-原理"><a href="#go-gc-原理" class="headerlink" title="go gc 原理"></a>go gc 原理</h3><p>从进程虚拟地址空间来看，程序要执行的指令在代码段，全局变量、静态数据等都会分配在数据段。而函数的局部变量、参数和返回值都可以在函数栈帧中找到。</p><p>但是，由于函数调用栈会在函数返回后销毁，那些在编译阶段不能确定大小的数据，以及生命周期超出当前函数的数据，都不适合分配在栈上。它们会被分配到堆上，在栈上使用其在堆上的地址。gc主要是清理堆上的数据。</p><p>那怎么区分哪些是有用数据？哪些是垃圾呢？</p><p>从虚拟地址空间来看，可以确定的是，程序中用得到的数据，一定是从栈、数据段这些地方追踪得到的数据。也就是说，以这些地方直接追踪到的变量作为根节点，可以追踪到的数据范围大于等于真正的有用数据。</p><p>（1）垃圾回收开始会把所有数据都标记为白色；<br>（2）然后把直接追踪到的root节点都标记为灰色，灰色代表基于当前节点展开的追踪还未完成；<br>（3）当基于某个节点的追踪任务完成后，便会把该节点标记为黑色，表示它是有用数据，而且无需基于它再次进行追踪了。<br>（4）当没有灰色节点时，就意味着标记工作可以结束了。此时有用数据都为黑色，垃圾都为白色，在清除阶段回收这些白色的垃圾即可。</p><p>垃圾回收的过程会产生stw，所以我们需要暂停的时间尽可能短，因此go使用主体并发增量式回收，指用户程序与垃圾回收交替执行，将垃圾回收工作分多次完成，也将暂停的时间分摊到多次，进而缩短每次暂停的时间。但是这也带来了额外的问题，交替执行的过程中，保不齐垃圾回收程序前脚刚把一个变量标记为垃圾，用户程序后脚又用到了它。</p><p>因此引入了写屏障，删除屏障。<br>写屏障：A已经被标记为黑色，若增加A到白色对象C的引用，可以通过写屏障直接把C标记为灰色；也可以把A回退到灰色状态<br>删除屏障：在删除灰色对象A到白色对象C的引用时，把C着为灰色</p><h3 id="如何应对碎片化内存？"><a href="#如何应对碎片化内存？" class="headerlink" title="如何应对碎片化内存？"></a>如何应对碎片化内存？</h3><p>应对这一问题的办法主要是使用多个链表，不同链表管理不同大小的内存块，这样就可以快速找到符合条件的内存分块了。<br>因为mutator通常不会频繁申请大块内存，所以多链表管理的内存块规格主要面向中小分块，既可以满足大部分内存分配需求，又避免维护大块空闲链表而压迫到内存。</p><h3 id="并发GC如何缓解内存分配压力？"><a href="#并发GC如何缓解内存分配压力？" class="headerlink" title="并发GC如何缓解内存分配压力？"></a>并发GC如何缓解内存分配压力？</h3><p>为了避免GC执行过程中，内存分配压力过大，还实现了GC Assist机制，包括“辅助标记”和“辅助清扫”。<br>如果协程要分配内存，而GC标记工作尚未完成，它就要负担一部分标记工作，要申请的内存越大，对应要负担的标记任务就越多，这是一种借贷偿还机制。</p><h3 id="如何控制GC的CPU使用率？"><a href="#如何控制GC的CPU使用率？" class="headerlink" title="如何控制GC的CPU使用率？"></a>如何控制GC的CPU使用率？</h3><p>GC默认的CPU目标使用率为25%，在GC执行的初始化阶段，会根据当前CPU核数乘以CPU目标使用率来计算需要启动的mark worker数量。<br>(1)Dedicated模式的worker会执行标记任务直到被抢占；<br>(2)Fractional模式的worker除了被抢占外，还可以在达到目标使用率时主动让出。</p><p>例如，如果有四个核，4<em>25%=1，只需要启动一个Dedicated模式的worker。<br>如果有六个核，6</em>25%=1.5，rounding以后等于2，误差=2/1.5-1=1/3，误差超过0.3，所以Dedicated模式的worker要是有2个就超出目标使用率太多了，需要减去一个，再启用一个Fractional模式的worker来辅助完成额外的目标。</p><h2 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h2><h3 id="内存结构"><a href="#内存结构" class="headerlink" title="内存结构"></a>内存结构</h3><p>堆地址空间划分成一个一个的arena。在AMD64位的linux环境下，每个arena的大小是64M。<br>每个arena包含8192个page，每个page是8k。<br>go语言内存分配是按照一组预置的大小规格，把内存页划分成块，然后把不同规格的内存块放到对应的空闲链表中。程序申请内存时，分配器会先根据要申请的内存大小，找到最匹配的规格，然后从对应空闲链表中分配一个内存块。</p><p>go语言中给出67种预置的大小规格，最小为8位(B)最大为32K，所以arena中又被划分出span，每个span中包含一组连续的page，并且按照特定规格划分成了等大的内存块。</p><h3 id="知道golang的内存逃逸吗-什么情况下会发生内存逃逸"><a href="#知道golang的内存逃逸吗-什么情况下会发生内存逃逸" class="headerlink" title="知道golang的内存逃逸吗?什么情况下会发生内存逃逸?"></a>知道golang的内存逃逸吗?什么情况下会发生内存逃逸?</h3><p>golang程序变量会携带有一组校验数据，用来证明它的整个生命周期是否在运行时完全可知。<br>如果变量通过了这些校验，它就可以在栈上分配。否则就说它逃逸了，必须在堆上分配。</p><p>能引起变量逃逸到堆上的典型情况:</p><ol><li>在方法内把局部变量指针返回： 局部变量原本应该在栈中分配，在栈中回收。但是由于返回时被外部引用，因此其生命周期大于栈，则溢出。</li><li>发送指针或带有指针的值到 channel 中：在编译时，是没有办法知道哪个 goroutine 会在 channel 上接收数据，所以编译器没法知道变量什么时候才会被释放。</li><li>在一个切片上存储指针或带指针的值：一个典型的例子就是 []*string 。这会导致切片的内容逃逸。尽管其后面的数组可能是在栈上分配的，但其引用的值一定是在堆上。</li><li>slice 的背后数组被重新分配了： append 时可能会超出其容量( cap )。 slice 初始化的地方在编译时是可以知道的，它最开始会在栈上分配。如果切片背后的存储要基于运行时的数据进行扩充，就会在堆上分配。</li><li>在 interface 类型上调用方法：在 interface 类型上调用方法都是动态调度的 —— 方法的真正实现只能在运行时知道。想像一个 io.Reader 类型的变量 r , 调用 r.Read(b) 会使得 r 的值和切片b 的背后存储都逃逸掉，所以会在堆上分配。</li></ol><h3 id="怎么分析内存逃逸？"><a href="#怎么分析内存逃逸？" class="headerlink" title="怎么分析内存逃逸？"></a>怎么分析内存逃逸？</h3><p>go build -gcflags ‘-m’ main.go</p><p>”escapes to heap”，代表该行内存分配发生了逃逸现象。</p></div><div><div><div style="text-align:center;color:#bfbfbf;font-size:16px"><span>-------- 本文结束 </span><i class="fa fa-angellist"></i> <span>感谢阅读 --------</span></div></div></div><div><div class="my_post_copyright"><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/%E9%9D%A2%E8%AF%95/Go-Interview/">Go面试必备</a></p><p><span>文章作者:</span>Guyuqing</p><p><span>发布时间:</span>2021年10月06日 - 11:50</p><p><span>最后更新:</span>2021年10月12日 - 20:43</p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click((function(){clipboard.on("success",(function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})}))}))</script></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持技术分享，您的支持将鼓励我继续创作！</div><button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wechatpay.jpg" alt=" 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/images/alipay.jpg" alt=" 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Go/" rel="tag"><i class="fa fa-tag"></i> Go</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag"><i class="fa fa-tag"></i> 面试</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/go/Go-Concurrent/" rel="next" title="Go并发"><i class="fa fa-chevron-left"></i> Go并发</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.png" alt=""><p class="site-author-name" itemprop="name"></p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">51</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">19</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">38</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/a19140312" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="http://weibo.com/" target="_blank" title="微博"><i class="fa fa-fw fa-weibo"></i>微博</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Go-%E9%9D%A2%E8%AF%95"><span class="nav-number">1.</span> <span class="nav-text">Go 面试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80"><span class="nav-number">1.1.</span> <span class="nav-text">基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%80%BC%E4%B8%BA-nil-%E7%9A%84-slice%E3%80%81map%E4%BC%9A%E5%8F%91%E7%94%9F%E5%95%A5"><span class="nav-number">1.1.1.</span> <span class="nav-text">使用值为 nil 的 slice、map会发生啥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-JSON-%E6%95%B0%E6%8D%AE%E6%97%B6%EF%BC%8C%E9%BB%98%E8%AE%A4%E5%B0%86%E6%95%B0%E5%80%BC%E5%BD%93%E5%81%9A%E5%93%AA%E7%A7%8D%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.1.2.</span> <span class="nav-text">解析 JSON 数据时，默认将数值当做哪种类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#recover%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="nav-number">1.1.3.</span> <span class="nav-text">recover的执行时机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#new%E5%92%8Cmake%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.1.4.</span> <span class="nav-text">new和make的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E5%8C%85%E5%90%AB%E5%93%AA%E4%BA%9B"><span class="nav-number">1.1.5.</span> <span class="nav-text">go语言中的引用类型包含哪些</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-struct%E8%83%BD%E4%B8%8D%E8%83%BD%E6%AF%94%E8%BE%83"><span class="nav-number">1.1.6.</span> <span class="nav-text">go struct能不能比较</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Context"><span class="nav-number">1.2.</span> <span class="nav-text">Context</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Map"><span class="nav-number">1.3.</span> <span class="nav-text">Map</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Map-%E7%BB%93%E6%9E%84"><span class="nav-number">1.3.1.</span> <span class="nav-text">Map 结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Map-%E6%89%A9%E5%AE%B9"><span class="nav-number">1.3.2.</span> <span class="nav-text">Map 扩容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Slice"><span class="nav-number">1.4.</span> <span class="nav-text">Slice</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E7%89%87%E5%92%8C%E6%95%B0%E7%BB%84%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.4.1.</span> <span class="nav-text">切片和数组的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Slice%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.4.2.</span> <span class="nav-text">Slice的底层实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Slice%E7%9A%84%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%EF%BC%8C%E6%9C%89%E4%BB%80%E4%B9%88%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="nav-number">1.4.3.</span> <span class="nav-text">Slice的扩容机制，有什么注意点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Channel"><span class="nav-number">1.5.</span> <span class="nav-text">Channel</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Channel-%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.5.1.</span> <span class="nav-text">Channel 的底层实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#channel-%E5%85%B3%E9%97%AD%E5%90%8E%E4%BC%9A%E6%80%8E%E6%A0%B7%EF%BC%9F"><span class="nav-number">1.5.2.</span> <span class="nav-text">channel 关闭后会怎样？</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#recvq%E9%87%8C%E6%9C%89%E5%8D%8F%E7%A8%8B%E7%AD%89%E5%BE%85"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">recvq里有协程等待</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E8%BF%98%E6%9C%89%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%BD%86sendq-%E4%B8%BA%E7%A9%BA"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">缓冲区还有数据，但sendq 为空</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sendq%E4%B8%8D%E4%B8%BA%E7%A9%BA"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">sendq不为空</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Goroutine"><span class="nav-number">1.6.</span> <span class="nav-text">Goroutine</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B"><span class="nav-number">1.6.1.</span> <span class="nav-text">进程、线程、协程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GMP%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.6.2.</span> <span class="nav-text">GMP模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GMP%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%99%90%E5%88%B6"><span class="nav-number">1.6.3.</span> <span class="nav-text">GMP模型的限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sync"><span class="nav-number">1.7.</span> <span class="nav-text">sync</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sync-WaitGroup-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.7.1.</span> <span class="nav-text">sync.WaitGroup 的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sync-Mutex-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.7.2.</span> <span class="nav-text">sync.Mutex 的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sync-Map-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.7.3.</span> <span class="nav-text">sync.Map 的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81double-check%EF%BC%9F"><span class="nav-number">1.7.3.1.</span> <span class="nav-text">为什么要double check？</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GC"><span class="nav-number">1.8.</span> <span class="nav-text">GC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#go-gc-%E5%8E%9F%E7%90%86"><span class="nav-number">1.8.1.</span> <span class="nav-text">go gc 原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%BA%94%E5%AF%B9%E7%A2%8E%E7%89%87%E5%8C%96%E5%86%85%E5%AD%98%EF%BC%9F"><span class="nav-number">1.8.2.</span> <span class="nav-text">如何应对碎片化内存？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91GC%E5%A6%82%E4%BD%95%E7%BC%93%E8%A7%A3%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%8E%8B%E5%8A%9B%EF%BC%9F"><span class="nav-number">1.8.3.</span> <span class="nav-text">并发GC如何缓解内存分配压力？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%8E%A7%E5%88%B6GC%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%EF%BC%9F"><span class="nav-number">1.8.4.</span> <span class="nav-text">如何控制GC的CPU使用率？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AD%98"><span class="nav-number">1.9.</span> <span class="nav-text">内存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84"><span class="nav-number">1.9.1.</span> <span class="nav-text">内存结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E9%81%93golang%E7%9A%84%E5%86%85%E5%AD%98%E9%80%83%E9%80%B8%E5%90%97-%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E5%8F%91%E7%94%9F%E5%86%85%E5%AD%98%E9%80%83%E9%80%B8"><span class="nav-number">1.9.2.</span> <span class="nav-text">知道golang的内存逃逸吗?什么情况下会发生内存逃逸?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%8E%E4%B9%88%E5%88%86%E6%9E%90%E5%86%85%E5%AD%98%E9%80%83%E9%80%B8%EF%BC%9F"><span class="nav-number">1.9.3.</span> <span class="nav-text">怎么分析内存逃逸？</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright" style="text-align:center">&copy; 2019 &mdash; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">guyuqing</span><div class="theme-info"><div class="powered-by"></div><i class="fa fa-book"></i> <span class="post-count">全站共202.7k字</span></div></div><script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script><div class="busuanzi-count" style="text-align:center"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> 访问人数 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人 </span><span class="site-pv"><i class="fa fa-eye"></i> 总访问量 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">var GUEST=["nick","mail","link"],guest="nick,mail";guest=guest.split(",").filter(a=>GUEST.indexOf(a)>-1),new Valine({el:"#comments",verify:!1,notify:!1,appId:"aO40hbMXUEahTdJdAEqaHaaa-gzGzoHsz",appKey:"T5zgBwJL4cnGAPVsarQphtMa",placeholder:"想对作者说点什么～",avatar:"monsterid",guest_info:guest,pageSize:"10"})</script><script type="text/javascript">var isfetched=!1,isXml=!0,search_path="search.json";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map((function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}})).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach((function(n){var r=!1,s=0,a=0,i=n.title.trim(),c=i.toLowerCase(),l=n.content.trim().replace(/<[^>]+>/g,""),h=l.toLowerCase(),p=decodeURIComponent(n.url),u=[],f=[];if(""!=i&&(e.forEach((function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}u=u.concat(e(t,c,!1)),f=f.concat(e(t,h,!1))})),(u.length>0||f.length>0)&&(r=!0,s=u.length+f.length)),r){function d(e,o,n,r){for(var s=r[r.length-1],i=s.position,c=s.word,l=[],h=0;i+c.length<=n&&0!=r.length;){c===t&&h++,l.push({position:i,length:c.length});var p=i+c.length;for(r.pop();0!=r.length&&(i=(s=r[r.length-1]).position,c=s.word,p>i);)r.pop()}return a+=h,{hits:l,start:o,end:n,searchTextCount:h}}[u,f].forEach((function(t){t.sort((function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length}))}));var g=[];0!=u.length&&g.push(d(0,0,i.length,u));for(var v=[];0!=f.length;){var $=f[f.length-1],C=$.position,m=$.word,x=C-20,w=C+80;x<0&&(x=0),w<C+m.length&&(w=C+m.length),w>l.length&&(w=l.length),v.push(d(0,x,w,f))}v.sort((function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start}));var y=parseInt("1");function T(t,e){var o="",n=e.start;return e.hits.forEach((function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r})),o+=t.substring(n,e.end)}y>=0&&(v=v.slice(0,y));var b="";0!=g.length?b+="<li><a href='"+p+"' class='search-result-title'>"+T(i,g[0])+"</a>":b+="<li><a href='"+p+"' class='search-result-title'>"+i+"</a>",v.forEach((function(t){b+="<a href='"+p+'\'><p class="search-result">'+T(l,t)+"...</p></a>"})),b+="</li>",o.push({item:b,searchTextCount:a,hitCount:s,id:o.length})}})),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort((function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id}));var a='<ul class="search-result-list">';o.forEach((function(t){a+=t.item})),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click((function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()})),$(".popup-btn-close").click(onPopupClose),$(".popup").click((function(t){t.stopPropagation()})),$(document).on("keyup",(function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()}))</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>